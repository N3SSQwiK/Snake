<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Skip link for keyboard users -->
    <a href="#game-canvas" class="skip-link">Skip to game</a>

    <!-- Screen reader announcements -->
    <div id="sr-announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>
    <div id="sr-score" class="sr-only" aria-live="polite" aria-atomic="true"></div>

    <div class="game-container" role="main">
        <!-- HUD (above canvas, visible during gameplay) -->
        <div class="game-hud" id="game-hud">
            <div class="hud-stat">
                <span class="hud-label">Score</span>
                <span class="hud-value" id="hud-score">0</span>
            </div>
            <div class="hud-stat">
                <span class="hud-label">Length</span>
                <span class="hud-value" id="hud-length">3</span>
            </div>
            <div class="hud-stat">
                <span class="hud-label">Difficulty</span>
                <span class="hud-value" id="hud-difficulty">Medium</span>
            </div>
            <div class="hud-stat hud-stat--toxic" id="hud-toxic" hidden>
                <span class="hud-label">Toxic Penalty</span>
                <span class="hud-value hud-value--danger">
                    <span id="hud-toxic-points">-5 pts</span>
                    <span class="hud-sep">|</span>
                    <span id="hud-toxic-segments">-1 seg</span>
                </span>
            </div>
            <div class="hud-stat" id="hud-timer-stat" hidden>
                <span class="hud-label">Time</span>
                <span class="hud-value" id="hud-timer">1:00</span>
            </div>
        </div>

        <canvas id="game-canvas" role="application" aria-label="Snake game - Use arrow keys or WASD to control the snake" tabindex="0"></canvas>

        <!-- Virtual D-Pad (mobile only, visible during PLAYING when D-pad mode selected) -->
        <div class="dpad" id="dpad" hidden aria-label="Directional pad">
            <button class="dpad__btn dpad__btn--up" data-dir="up" aria-label="Move up">
                <svg viewBox="0 0 24 24" width="20" height="20"><path d="M12 8l-6 6h12z" fill="currentColor"/></svg>
            </button>
            <button class="dpad__btn dpad__btn--left" data-dir="left" aria-label="Move left">
                <svg viewBox="0 0 24 24" width="20" height="20"><path d="M8 12l6-6v12z" fill="currentColor"/></svg>
            </button>
            <button class="dpad__btn dpad__btn--right" data-dir="right" aria-label="Move right">
                <svg viewBox="0 0 24 24" width="20" height="20"><path d="M16 12l-6-6v12z" fill="currentColor"/></svg>
            </button>
            <button class="dpad__btn dpad__btn--down" data-dir="down" aria-label="Move down">
                <svg viewBox="0 0 24 24" width="20" height="20"><path d="M12 16l6-6H6z" fill="currentColor"/></svg>
            </button>
        </div>

        <!-- UI Overlay — screens shown/hidden via data-state and data-ui attributes -->
        <div id="overlay" class="overlay">

            <!-- Start Menu -->
            <div class="screen-menu" role="dialog" aria-label="Start menu">
                <div class="ui-panel">
                    <h1 class="ui-title">SNAKE</h1>
                    <div class="ui-btn-group">
                        <button class="ui-btn ui-btn--primary" data-action="play">Play</button>
                        <button class="ui-btn ui-btn--ghost" data-action="settings">Settings</button>
                        <button class="ui-btn ui-btn--ghost" data-action="highscores">High Scores</button>
                    </div>
                </div>
            </div>

            <!-- Mode Select Screen -->
            <div class="screen-mode-select" role="dialog" aria-label="Select game mode">
                <div class="ui-panel">
                    <h2 class="ui-heading">Select Mode</h2>
                    <div class="mode-card-grid ui-segmented" role="radiogroup" aria-label="Game mode">
                        <button class="mode-card ui-segmented__option" data-mode="classic" role="radio" aria-checked="true">
                            <span class="mode-card__name">Classic</span>
                            <span class="mode-card__desc">Eat food, grow longer, don't hit walls</span>
                        </button>
                        <button class="mode-card ui-segmented__option" data-mode="timeAttack" role="radio" aria-checked="false">
                            <span class="mode-card__name">Time Attack</span>
                            <span class="mode-card__desc">Score as much as you can in 60 seconds</span>
                        </button>
                        <button class="mode-card ui-segmented__option" data-mode="maze" role="radio" aria-checked="false">
                            <span class="mode-card__name">Maze</span>
                            <span class="mode-card__desc">Navigate through random obstacles</span>
                        </button>
                        <button class="mode-card ui-segmented__option" data-mode="zen" role="radio" aria-checked="false">
                            <span class="mode-card__name">Zen</span>
                            <span class="mode-card__desc">Relaxed play, no score or game over</span>
                        </button>
                    </div>
                    <button class="ui-btn ui-btn--primary" data-action="start-game">Start Game</button>
                </div>
            </div>

            <!-- Pause Overlay -->
            <div class="screen-pause" role="dialog" aria-label="Game paused">
                <div class="ui-panel">
                    <h2 class="ui-heading">Paused</h2>
                    <div class="ui-btn-group">
                        <button class="ui-btn ui-btn--primary" data-action="resume">Resume</button>
                        <button class="ui-btn ui-btn--ghost" data-action="settings">Settings</button>
                        <button class="ui-btn ui-btn--danger" data-action="quit">Quit</button>
                    </div>
                </div>
            </div>

            <!-- Game Over Screen -->
            <div class="screen-gameover" role="dialog" aria-label="Game over">
                <div class="ui-panel">
                    <h2 class="ui-heading" id="gameover-heading">Game Over</h2>
                    <p class="ui-score" id="final-score">0</p>
                    <p class="ui-label" id="best-score"></p>
                    <p class="ui-label" id="leaderboard-status"></p>
                    <p class="ui-label theme-unlock-notice" id="theme-unlock-status"></p>
                    <div class="ui-btn-group">
                        <button class="ui-btn ui-btn--primary" data-action="restart">Restart</button>
                        <button class="ui-btn ui-btn--ghost" data-action="highscores">View Leaderboard</button>
                        <button class="ui-btn ui-btn--ghost" data-action="menu">Menu</button>
                    </div>
                </div>
            </div>

            <!-- Initials Entry (modal overlay) -->
            <div class="screen-initials" role="dialog" aria-modal="true" aria-label="Enter initials">
                <div class="ui-panel">
                    <h2 class="ui-heading">New High Score!</h2>
                    <p class="ui-score" id="initials-score">0</p>
                    <div class="initials-slots">
                        <div class="initials-slot initials-slot--active" data-index="0" tabindex="0" role="button" aria-label="First letter, A">A</div>
                        <div class="initials-slot" data-index="1" tabindex="0" role="button" aria-label="Second letter, A">A</div>
                        <div class="initials-slot" data-index="2" tabindex="0" role="button" aria-label="Third letter, A">A</div>
                        <input id="initials-mobile-input" type="text" autocomplete="off" autocapitalize="characters" maxlength="1" aria-label="Type letter" />
                    </div>
                    <p class="ui-label">Type or tap slots to enter, arrows to cycle</p>
                    <div class="ui-btn-group">
                        <button class="ui-btn ui-btn--primary" data-action="submit-initials">Submit</button>
                        <button class="ui-btn ui-btn--ghost" data-action="skip-initials">Skip</button>
                    </div>
                </div>
            </div>

            <!-- Leaderboard (modal overlay) -->
            <div class="screen-leaderboard" role="dialog" aria-modal="true" aria-label="High scores">
                <div class="ui-panel ui-panel--wide">
                    <button class="ui-panel__close" data-action="leaderboard-back" aria-label="Close leaderboard">&times;</button>
                    <h2 class="ui-heading">High Scores</h2>
                    <div class="leaderboard-pager" role="region" aria-label="Leaderboard mode">
                        <button class="leaderboard-pager__arrow" data-action="leaderboard-prev" aria-label="Previous mode" tabindex="-1">&#8249;</button>
                        <span class="leaderboard-pager__title" aria-live="polite">Classic</span>
                        <button class="leaderboard-pager__arrow" data-action="leaderboard-next" aria-label="Next mode" tabindex="-1">&#8250;</button>
                        <div class="leaderboard-pager__dots"></div>
                    </div>
                    <div class="leaderboard-table" id="leaderboard-body" aria-live="polite" aria-atomic="true"></div>
                </div>
            </div>

            <!-- Settings Screen (modal overlay) -->
            <div class="screen-settings" role="dialog" aria-modal="true" aria-label="Settings">
                <div class="ui-panel">
                    <button class="ui-panel__close" data-action="settings-back" aria-label="Close settings">&times;</button>
                    <h2 class="ui-heading">Settings</h2>
                    <div class="ui-setting-group">
                        <label class="ui-label">Difficulty</label>
                        <div class="ui-segmented" id="difficulty-selector" role="radiogroup" aria-label="Difficulty">
                            <button class="ui-segmented__option" data-difficulty="easy" role="radio" aria-checked="false">
                                <span class="ui-segmented__label">Easy</span>
                                <span class="ui-segmented__desc">Walls wrap, no hazard food</span>
                            </button>
                            <button class="ui-segmented__option" data-difficulty="medium" role="radio" aria-checked="true">
                                <span class="ui-segmented__label">Medium</span>
                                <span class="ui-segmented__desc">Walls kill, toxic food appears</span>
                            </button>
                            <button class="ui-segmented__option" data-difficulty="hard" role="radio" aria-checked="false">
                                <span class="ui-segmented__label">Hard</span>
                                <span class="ui-segmented__desc">Walls kill, toxic and lethal food</span>
                            </button>
                        </div>
                    </div>
                    <div class="ui-setting-group">
                        <label class="ui-label">Sound</label>
                        <div class="ui-setting-row">
                            <label class="ui-label ui-label--small" for="volume-slider">Volume</label>
                            <div class="ui-slider-row">
                                <input type="range" id="volume-slider" class="ui-slider" min="0" max="100" value="50" aria-label="Volume">
                                <span class="ui-slider-value" id="volume-value">50%</span>
                            </div>
                        </div>
                        <div class="ui-setting-row">
                            <label class="ui-label ui-label--small" for="mute-toggle">Mute</label>
                            <button class="ui-toggle" id="mute-toggle" role="switch" aria-checked="false" data-action="toggle-mute">
                                <span class="ui-toggle__track">
                                    <span class="ui-toggle__thumb"></span>
                                </span>
                            </button>
                        </div>
                    </div>
                    <div class="ui-setting-group ui-setting-group--touch-only" id="controls-group">
                        <label class="ui-label">Controls</label>
                        <div class="ui-segmented" id="mobile-input-selector" role="radiogroup" aria-label="Mobile input method">
                            <button class="ui-segmented__option" data-input="swipe" role="radio" aria-checked="true">
                                <span class="ui-segmented__label">Swipe</span>
                                <span class="ui-segmented__desc">Swipe to change direction</span>
                            </button>
                            <button class="ui-segmented__option" data-input="dpad" role="radio" aria-checked="false">
                                <span class="ui-segmented__label">D-Pad</span>
                                <span class="ui-segmented__desc">On-screen directional buttons</span>
                            </button>
                        </div>
                    </div>
                    <div class="ui-setting-group">
                        <label class="ui-label">Accessibility</label>
                        <div class="ui-setting-row">
                            <label class="ui-label ui-label--small" for="reduce-motion-toggle">Reduce Motion</label>
                            <button class="ui-toggle" id="reduce-motion-toggle" role="switch" aria-checked="false" data-action="toggle-reduce-motion">
                                <span class="ui-toggle__track">
                                    <span class="ui-toggle__thumb"></span>
                                </span>
                            </button>
                        </div>
                        <div class="ui-setting-row">
                            <label class="ui-label ui-label--small" for="animation-style-toggle">Smooth Animation</label>
                            <button class="ui-toggle" id="animation-style-toggle" role="switch" aria-checked="true" data-action="toggle-animation-style">
                                <span class="ui-toggle__track">
                                    <span class="ui-toggle__thumb"></span>
                                </span>
                            </button>
                        </div>
                        <p class="ui-setting-hint" id="animation-hint" hidden>Disabled by Reduce Motion</p>
                        <div class="ui-setting-row">
                            <label class="ui-label ui-label--small" for="colorblind-mode-toggle">Shape Outlines</label>
                            <button class="ui-toggle" id="colorblind-mode-toggle" role="switch" aria-checked="false" data-action="toggle-colorblind-mode">
                                <span class="ui-toggle__track">
                                    <span class="ui-toggle__thumb"></span>
                                </span>
                            </button>
                        </div>
                        <div class="ui-setting-row">
                            <label class="ui-label ui-label--small" for="accessibility-mode-toggle">Extended Time Mode</label>
                            <button class="ui-toggle" id="accessibility-mode-toggle" role="switch" aria-checked="false" data-action="toggle-accessibility-mode">
                                <span class="ui-toggle__track">
                                    <span class="ui-toggle__thumb"></span>
                                </span>
                            </button>
                        </div>
                    </div>
                    <div class="theme-picker">
                        <label class="ui-label">Theme</label>
                        <div class="theme-picker__grid" id="theme-picker-grid"></div>
                    </div>
                </div>
            </div>

            <!-- Keyboard Shortcuts Help (modal overlay) -->
            <div class="screen-shortcuts" role="dialog" aria-modal="true" aria-label="Keyboard shortcuts">
                <div class="ui-panel">
                    <button class="ui-panel__close" data-action="shortcuts-back" aria-label="Close keyboard shortcuts">&times;</button>
                    <h2 class="ui-heading">Keyboard Shortcuts</h2>
                    <div class="shortcuts-list">
                        <div class="shortcuts-section">
                            <h3 class="shortcuts-section__title">Gameplay</h3>
                            <div class="shortcut-row">
                                <span class="shortcut-keys"><kbd>↑</kbd><kbd>↓</kbd><kbd>←</kbd><kbd>→</kbd></span>
                                <span class="shortcut-desc">Move snake</span>
                            </div>
                            <div class="shortcut-row">
                                <span class="shortcut-keys"><kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd></span>
                                <span class="shortcut-desc">Move snake (alternate)</span>
                            </div>
                            <div class="shortcut-row">
                                <span class="shortcut-keys"><kbd>Space</kbd> / <kbd>P</kbd></span>
                                <span class="shortcut-desc">Pause / Resume</span>
                            </div>
                            <div class="shortcut-row">
                                <span class="shortcut-keys"><kbd>Esc</kbd></span>
                                <span class="shortcut-desc">Pause game / Close menu</span>
                            </div>
                        </div>
                        <div class="shortcuts-section">
                            <h3 class="shortcuts-section__title">Menus</h3>
                            <div class="shortcut-row">
                                <span class="shortcut-keys"><kbd>↑</kbd><kbd>↓</kbd></span>
                                <span class="shortcut-desc">Cycle through buttons</span>
                            </div>
                            <div class="shortcut-row">
                                <span class="shortcut-keys"><kbd>Enter</kbd> / <kbd>Space</kbd></span>
                                <span class="shortcut-desc">Activate button</span>
                            </div>
                            <div class="shortcut-row">
                                <span class="shortcut-keys"><kbd>Backspace</kbd></span>
                                <span class="shortcut-desc">Go back / close modal</span>
                            </div>
                            <div class="shortcut-row">
                                <span class="shortcut-keys"><kbd>Tab</kbd></span>
                                <span class="shortcut-desc">Navigate to next element</span>
                            </div>
                            <div class="shortcut-row">
                                <span class="shortcut-keys"><kbd>Shift</kbd>+<kbd>Tab</kbd></span>
                                <span class="shortcut-desc">Navigate to previous element</span>
                            </div>
                            <div class="shortcut-row">
                                <span class="shortcut-keys"><kbd>?</kbd></span>
                                <span class="shortcut-desc">Show this help</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Pause Button (coarse pointer only) -->
        <button class="mobile-pause-btn" data-action="pause" aria-label="Pause game">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <rect x="4" y="3" width="4" height="14" rx="1" fill="currentColor"/>
                <rect x="12" y="3" width="4" height="14" rx="1" fill="currentColor"/>
            </svg>
        </button>
    </div>

    <!-- Landscape rotation prompt (mobile only) -->
    <div class="landscape-overlay" aria-hidden="true">
        <div class="landscape-overlay__content">
            <svg class="landscape-overlay__icon" width="48" height="48" viewBox="0 0 48 48" fill="none">
                <rect x="10" y="6" width="28" height="36" rx="4" stroke="currentColor" stroke-width="2.5" fill="none"/>
                <path d="M38 30l6-6m0 0l-6-6m6 6H32" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <p>Please rotate your device to portrait mode</p>
        </div>
    </div>

    <script src="game.js"></script>
</body>
</html>
